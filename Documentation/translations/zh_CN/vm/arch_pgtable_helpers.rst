.. SPDX-License-Identifier: GPL-2.0

.. include:: ../disclaimer-zh_CN.rst

.. _arch_page_table_helpers:

:Original: Documentation/vm/arch_pgtable_helpers.rst

:译者:

 蒋子奇 Jiang Ziqi <jiangziqi@360.cn>


====================
体系架构页表辅助函数
====================

通用内存管理单元期望体系结构（使用MMU）提供辅助函数，为不同的内存函数在不同的级别
上创建、访问和修改页表项。这些页表辅助函数需要符合跨平台的通用语义。下面的表描述
了期望的语义，也可以在引导期间通过CONFIG_DEBUG_VM_PGTABLE选项进行测试。这里的所有
未来可能的更改或调试测试都需要同步。

===============
PTE页表辅助函数
===============

+---------------------------+--------------------------------------------------+
| pte_same                  | 测试两个PTE表项是否相同                          |
+---------------------------+--------------------------------------------------+
| pte_bad                   | 测试非表映射的PTE                                |
+---------------------------+--------------------------------------------------+
| pte_present               | 测试一个PTE是否存在                                |
+---------------------------+--------------------------------------------------+
| pte_young                 | 测试一个PTE是否是年轻的                          |
+---------------------------+--------------------------------------------------+
| pte_dirty                 | 测试一个PTE是否是脏的                            |
+---------------------------+--------------------------------------------------+
| pte_write                 | 测试一个PTE是否可写                              |
+---------------------------+--------------------------------------------------+
| pte_special               | 测试一个PTE是否是特殊的                          |
+---------------------------+--------------------------------------------------+
| pte_protnone              | 测试一个PTE的PROT_NONE位                         |
+---------------------------+--------------------------------------------------+
| pte_devmap                | 测试一个PTE是否是ZONE_DEVICE映射的               |
+---------------------------+--------------------------------------------------+
| pte_soft_dirty            | 测试一个PTE是否是软脏的                          |
+---------------------------+--------------------------------------------------+
| pte_swp_soft_dirty        | 测试一个PTE是否是软脏可交换的                    |
+---------------------------+--------------------------------------------------+
| pte_mkyoung               | 创建一个年轻的PTE                                |
+---------------------------+--------------------------------------------------+
| pte_mkold                 | 创建一个老的PTE                                  |
+---------------------------+--------------------------------------------------+
| pte_mkdirty               | 创建一个脏的PTE                                  |
+---------------------------+--------------------------------------------------+
| pte_mkclean               | 创建一个干净的PTE                                |
+---------------------------+--------------------------------------------------+
| pte_mkwrite               | 创建一个可写的PTE                                |
+---------------------------+--------------------------------------------------+
| pte_wrprotect             | 创建一个不可写的PTE                              |
+---------------------------+--------------------------------------------------+
| pte_mkspecial             | 创建一个特殊的PTE                                |
+---------------------------+--------------------------------------------------+
| pte_mkdevmap              | 创建一个ZONE_DEVICE映射的PTE                     |
+---------------------------+--------------------------------------------------+
| pte_mksoft_dirty          | 创建一个软脏的PTE                                |
+---------------------------+--------------------------------------------------+
| pte_clear_soft_dirty      | 清除一个软脏的PTE                                |
+---------------------------+--------------------------------------------------+
| pte_swp_mksoft_dirty      | 创建一个软脏可交换的PTE                          |
+---------------------------+--------------------------------------------------+
| pte_swp_clear_soft_dirty  | 清除一个软脏可交换的PTE                          |
+---------------------------+--------------------------------------------------+
| pte_mknotpresent          | 使映射的PTE失效                                  |
+---------------------------+--------------------------------------------------+
| ptep_get_and_clear        | 清除一个PTE                                      |
+---------------------------+--------------------------------------------------+
| ptep_get_and_clear_full   | 清除一个PTE                                      |
+---------------------------+--------------------------------------------------+
| ptep_test_and_clear_young | 清除PTE的yong标志                                |
+---------------------------+--------------------------------------------------+
| ptep_set_wrprotect        | 转换为不可写的PTE                                |
+---------------------------+--------------------------------------------------+
| ptep_set_access_flags     | 转换为一个更宽松PTE                              |
+---------------------------+--------------------------------------------------+

===============
PMD页表辅助函数
===============

+---------------------------+--------------------------------------------------+
| pmd_same                  | 测试两个PMD项是否相同                            |
+---------------------------+--------------------------------------------------+
| pmd_bad                   | 测试是否为非表映射的PMD                          |
+---------------------------+--------------------------------------------------+
| pmd_leaf                  | 测试一个PMD是否为叶映射                          |
+---------------------------+--------------------------------------------------+
| pmd_huge                  | 测试一个PMD是否为HugeTLB映射                     |
+---------------------------+--------------------------------------------------+
| pmd_trans_huge            | 测试一个PMD是否为透明大页                        |
+---------------------------+--------------------------------------------------+
| pmd_present               | 测试一个PMD是否存在                              |
+---------------------------+--------------------------------------------------+
| pmd_young                 | 测试一个PMD是否是年轻的                          |
+---------------------------+--------------------------------------------------+
| pmd_dirty                 | 测试一个PMD是否是脏的                            |
+---------------------------+--------------------------------------------------+
| pmd_write                 | 测试一个PMD是否是可写的                          |
+---------------------------+--------------------------------------------------+
| pmd_special               | 测试一个PMD是否是特殊的                          |
+---------------------------+--------------------------------------------------+
| pmd_protnone              | 测试一个PMD的PROT_NONE位                         |
+---------------------------+--------------------------------------------------+
| pmd_devmap                | 测试一个PMD是否是ZONE_DEVICE映射                 |
+---------------------------+--------------------------------------------------+
| pmd_soft_dirty            | 测试一个PMD是否是软脏的                          |
+---------------------------+--------------------------------------------------+
| pmd_swp_soft_dirty        | 测试一个PMD是否为软脏可交换的                    |
+---------------------------+--------------------------------------------------+
| pmd_mkyoung               | 创建一个年轻的PMD                                |
+---------------------------+--------------------------------------------------+
| pmd_mkold                 | 创建一个老的PMD                                  |
+---------------------------+--------------------------------------------------+
| pmd_mkdirty               | 创建一个脏的PMD                                  |
+---------------------------+--------------------------------------------------+
| pmd_mkclean               | 创建一个干净的PMD                                |
+---------------------------+--------------------------------------------------+
| pmd_mkwrite               | 创建一个可写的PMD                                |
+---------------------------+--------------------------------------------------+
| pmd_wrprotect             | 创建一个不可写的PMD                              |
+---------------------------+--------------------------------------------------+
| pmd_mkspecial             | 创建一个特殊的PMD                                |
+---------------------------+--------------------------------------------------+
| pmd_mkdevmap              | 创建一个ZONE_DEVICE映射的PMD                     |
+---------------------------+--------------------------------------------------+
| pmd_mksoft_dirty          | 创建一个软脏的PMD                                |
+---------------------------+--------------------------------------------------+
| pmd_clear_soft_dirty      | 清除一个软脏的PMD                                |
+---------------------------+--------------------------------------------------+
| pmd_swp_mksoft_dirty      | 创建一个软脏可交换的PMD                          |
+---------------------------+--------------------------------------------------+
| pmd_swp_clear_soft_dirty  | 清除一个软脏可交换的PMD                          |
+---------------------------+--------------------------------------------------+
| pmd_mkinvalid             | 使映射的PMD无效 [1]                              |
+---------------------------+--------------------------------------------------+
| pmd_set_huge              | 创建一个PMD大页映射                              |
+---------------------------+--------------------------------------------------+
| pmd_clear_huge            | 清除一个PMD大页映射                              |
+---------------------------+--------------------------------------------------+
| pmdp_get_and_clear        | 清除一个PMD                                      |
+---------------------------+--------------------------------------------------+
| pmdp_get_and_clear_full   | 清除一个PMD                                      |
+---------------------------+--------------------------------------------------+
| pmdp_test_and_clear_young | 清除一个PMD的young位                             |
+---------------------------+--------------------------------------------------+
| pmdp_set_wrprotect        | 转换为不可写的PMD                                |
+---------------------------+--------------------------------------------------+
| pmdp_set_access_flags     | 转换为一个更宽松PMD                              |
+---------------------------+--------------------------------------------------+

===============
PUD页表辅助函数
===============

+---------------------------+--------------------------------------------------+
| pud_same                  | 测试两个PUD项是否相同                            |
+---------------------------+--------------------------------------------------+
| pud_bad                   | 测试是否为非表映射的PUD                          |
+---------------------------+--------------------------------------------------+
| pud_leaf                  | 测试是否叶映射PUD                                |
+---------------------------+--------------------------------------------------+
| pud_huge                  | 测试一个PUD是否位HugeTLB映射                     |
+---------------------------+--------------------------------------------------+
| pud_trans_huge            | 测试是否为透明大页PUD                            |
+---------------------------+--------------------------------------------------+
| pud_present               | 测试PUD是否存在                                  |
+---------------------------+--------------------------------------------------+
| pud_young                 | 测试一个PUD是否为年轻的                          |
+---------------------------+--------------------------------------------------+
| pud_dirty                 | 测试一个PUD是否为脏的                            |
+---------------------------+--------------------------------------------------+
| pud_write                 | 测试一个PUD是否为可写的                          |
+---------------------------+--------------------------------------------------+
| pud_devmap                | 测试一个PUD是否为ZONE_DEVICE映射                 |
+---------------------------+--------------------------------------------------+
| pud_mkyoung               | 创建一个年轻的PUD                                |
+---------------------------+--------------------------------------------------+
| pud_mkold                 | 创建一个老的PUD                                  |
+---------------------------+--------------------------------------------------+
| pud_mkdirty               | 创建一个脏的PUD                                  |
+---------------------------+--------------------------------------------------+
| pud_mkclean               | 创建一个干净的PUD                                |
+---------------------------+--------------------------------------------------+
| pud_mkwrite               | 创建一个可写的PUD                                |
+---------------------------+--------------------------------------------------+
| pud_wrprotect             | 创建一个不可写的PUD                              |
+---------------------------+--------------------------------------------------+
| pud_mkdevmap              | 创建一个ZONE_DEVICE映射的PUD                     |
+---------------------------+--------------------------------------------------+
| pud_mkinvalid             | 使映射的PUD失效 [1]                              |
+---------------------------+--------------------------------------------------+
| pud_set_huge              | 创建一个大页PUD映射                              |
+---------------------------+--------------------------------------------------+
| pud_clear_huge            | 清除PUD大页映射                                  |
+---------------------------+--------------------------------------------------+
| pudp_get_and_clear        | 清除一个PUD                                      |
+---------------------------+--------------------------------------------------+
| pudp_get_and_clear_full   | 清除一个PUD                                      |
+---------------------------+--------------------------------------------------+
| pudp_test_and_clear_young | 清除一个PUD的young标志                           |
+---------------------------+--------------------------------------------------+
| pudp_set_wrprotect        | 转换成不可写的PUD                                |
+---------------------------+--------------------------------------------------+
| pudp_set_access_flags     | 转换为一个更宽松的PUD                            |
+---------------------------+--------------------------------------------------+

===================
HugeTLB页表辅助函数
===================

+---------------------------+--------------------------------------------------+
| pte_huge                  | 测试是否为HugeTLB                                |
+---------------------------+--------------------------------------------------+
| pte_mkhuge                | 创建一个HugeTLB                                  |
+---------------------------+--------------------------------------------------+
| huge_pte_dirty            | 测试一个HugeTLB是否为脏的                        |
+---------------------------+--------------------------------------------------+
| huge_pte_write            | 测试一个HugeTLB是否为可写的                      |
+---------------------------+--------------------------------------------------+
| huge_pte_mkdirty          | 创建一个脏的HugeTLB                              |
+---------------------------+--------------------------------------------------+
| huge_pte_mkwrite          | 创建一个可写的HugeTLB                            |
+---------------------------+--------------------------------------------------+
| huge_pte_wrprotect        | 创建一个不可写的HugeTLB                          |
+---------------------------+--------------------------------------------------+
| huge_ptep_get_and_clear   | 清除一个HugeTLB                                  |
+---------------------------+--------------------------------------------------+
| huge_ptep_set_wrprotect   | 转换为不可写的HugeTLB                            |
+---------------------------+--------------------------------------------------+
| huge_ptep_set_access_flags  | 转换为一个更宽松的HugeTLB                      |
+---------------------------+--------------------------------------------------+

================
SWAP页表辅助函数
================

+---------------------------+--------------------------------------------------+
| __pte_to_swp_entry        | 从映射的PTE创建交换项（体系架构相关）            |
+---------------------------+--------------------------------------------------+
| __swp_to_pte_entry        | 从交换项（体系架构相关）创建映射的PTE            |
+---------------------------+--------------------------------------------------+
| __pmd_to_swp_entry        | 从映射的PMD创建交换项（体系架构相关）            |
+---------------------------+--------------------------------------------------+
| __swp_to_pmd_entry        | 从交换项（体系架构相关）创建映射的PMD            |
+---------------------------+--------------------------------------------------+
| is_migration_entry        | 测试迁移（读或写）交换项                         |
+---------------------------+--------------------------------------------------+
| is_write_migration_entry  | 测试写迁移交换项                                 |
+---------------------------+--------------------------------------------------+
| make_migration_entry_read | 转换为读迁移交换项                               |
+---------------------------+--------------------------------------------------+
| make_migration_entry      | 创建迁移交换项（读或写）                         |
+---------------------------+--------------------------------------------------+

[1] https://lore.kernel.org/linux-mm/20181017020930.GN30832@redhat.com/
